==================================
歌舞伎町マルチネフューチャーパーク
==================================
http://ameblo.jp/kabutine0602/



やること
========

来場者数500人に対してフリー WiFi を提供する
-------------------------------------------

- ほとんどが 802.11b/g スマートフォン
- ノートPC, iPad, 一部のスマートフォン向け 802.11a
- パフォーマー向けなど、有線 LAN 接続


買わないといけないもの
======================

- 養生テープ * 10 

  - LANケーブルを床に貼らないといけないのでかなり必要
  
  - 数個くらいおじさんに買ってもらえる。　


- LAN ケーブル
  
  - 3m * 5
  - 15m * 2

- **電源タップみんな持ってきて！！！！！！！**


決めたIPアドレスとか
====================

IX2015
------
メインのルータ, DHCPサーバ, DNS proxy

  - **FE0/0** To ONU **192.168.1.2/24**
    
    - **FE0/0.1** PPPoE *ipcp*

  - **FE0/1** shutdown (ip address *dhcp*)
  - **FE1/0** To clients

    - FE1/0:1.0 お客さん向け (**Port 1-3**) **172.25.0.254/16**  
    - FE1/0:2.0 内部向け(未使用予定)(**Port 4**) **192.168.47.254/24**

APなど
------
  - IP address

    - DHCPエリア **172.25.1.1 - 172.25.3.253**
    - router/dns **172.25.0.254**
    - switch1 **172.25.0.1**
    - switch2 **172.25.0.2**
    - AP1 AP1131-1 **172.25.0.10**  1ch
    - AP2 AP1131-2 **172.25.0.11** 11ch マピのところにあるやつ1
    - AP3 AP1231-1 **172.25.0.12**  6ch マピのところにあるやつ2
    - AP4 AP1231-2 **172.25.0.13** 11ch
    - AP5 AP1231-3 **172.25.0.14**  6ch
    - AP6 AP1231-4 **172.25.0.15**  予備

    - 監視用PC(webサーバ的な) **172.25.0.32**
    - マピエイリアンウェア **172.25.0.33**
    - その他 IP アドレス固定するようなもの 172.25.0.34付近



準備済のもの
==============

tinbotu
-------

- IX2015

- Cisco AIR-AP1231G-J-K9 * 5台

  - 11g, 11a(W52)
  
  - http://www.cisco.com/web/JP/product/hs/wireless/airo1200/prodlit/casap_ds.html

- Cisco AIR-AP1131AG-P-K9 * 3台

  - 11g, 11a(W53)

  - http://www.cisco.com/web/JP/product/hs/wireless/airo1130/prodlit/1130ag_ds.html

- Catalyst WS-C3524-PWR-XL

  - 24 ポート L2SW / 100Base-TX / Cisco PoE (not 802.3af)

- Cisco PoE パワーインジェクタ  * 7台 (離れたところで L2SW 挟むなら必要)

  - +48V ACアダプタ
  - 回線が不安定になっては困るので有線で繋ぎたいかも、と VJ からの要望あり
  - Ustream 向けに有線

- 家庭用 100M スイッチングハブ等 * 2

  - 8ポートくらいのもの

- LAN ケーブル

  - 20m * 2
  - 15m * 1
  - 10m * 2
  -  5m * 1
  -  3m * 4
  -  1m * 5
  -  50m * 2


- 電源タップ

  - 15m * 2
  - 5m * 3
  - 3m * 2
  - **まだ全然足りない**





WANTED
------

- ネットワーク監視マシン(cacti or munin or zabbix)

  - **mapi** ?

- 電源タップ、たこ足、LANケーブル、養生テープ　を大量に

  - アクセスポイントを遠くに設置するなら、ケーブルをひっかけないように完全に養生する必要がある



前回の反省をふまえて
====================


WiFi
----

- AP の設置場所が互いに近かった。できるだけ離して設置しよう

   - RF 空間を有効に使えなくなる
   - クライアントの分散が難しかった
   - 長い LAN ケーブルを準備できなかったり、AP の電源確保の問題もあった

     - ケーブルを用意する。お客さんがひっかけないように養生する



- ブロードキャストフレームによる RF 帯域消費を懸念してそれぞれの AP を VLAN で分離したけど

   - 管理が結構めんどう
   - チャネル少ないしどうせ無線はユニキャストでも RF 空間消費するのだし
   - やめよう


- SSID 名によるクライアントの偏り

   - うまいネーミングを考える必要

     - 2.4GHz

      - kabutine1
      - kabutine2
      - kabutine3
      - kabutine4
      - kabutine5

    - 5GHz 

      - kabutine1-highspeed
      - kabutine2-highspeed
      - kabutine3-highspeed
      - kabutine4-highspeed
      - kabutine5-highspeed

   - 他に案があれば

   - 802.11a に対応している端末はそちらにつないでもらえるよう周知徹底


- 多くの接続に耐える設定

   - 802.11b は対応しない
   - 速度が遅いクライアントの接続を制限する。これが多いとRF時空間の無駄遣い
   - 今回の会場では隠れ端末はそれほど多くなさそう
   - RTS/CTS と閾値は会場近隣の WiFi の混雑度で検討

     - サーベイの結果かなり混雑しているようだったので、特に窓側のアクセスポイントは厳しめにしたほうがいいかも
     
     - `会場周囲の b/g wifi <https://github.com/maltine-records/yakesummer/blob/master/wireless/pre_survey_passive_background.png>`_
     
   - ビーコンの変調速度を速めに

     - Maxrateを下げてエラーを減らす方向ではなく、低いレートは切ってRF時空間を稼いでみたい

- WPA等の暗号化を使用するか?

   - 前回のやけさまでは地下だったこともあり、お客さん以外が接続する可能性は低かった
   - 今回は繁華街の 5F であり、イベントと無関係なところまで電波が到達する可能性はそれなりにある

     - 暗号化を使用するとなるとパスフレーズの周知徹底が課題

       - パスフレーズの周知が手間ならば暗号化なしでもありか。数時間限定だし。

     - 暗号化を使用するなら弱い暗号形式で充分
   
   - ビーコンの変調を速くすれば遠くまで飛ばないから暗号化なしでもいいかも



Network
-------

- 前回実現できなかったネットワーク監視

   - 取得したい情報

     - 各 AP ごとに接続しているクライアント数
     - 各 AP ごとのトラフィック
     - ルータの NAPT テーブルのエントリ数

       - snmpでとれない
       
         - スクリプト書いた

     - ルータのトラフィック
  
   - できれば取得したい情報

     - クライアントごとの接続速度


   - グラフにプロットし、可能ならリアルタイムで公開したい

     - クライアントの自主的な手動負荷分散の期待
     - 見た目おもしろい
     - 数値を API で提供できればほかの企画と連動


会場の回線
----------


- 5/24 開通予定 NTT フレッツネクスト ＋ so-net
- ONUの線は公衆電話残骸（入ってすぐ）のところから出てきている

  - 長い LAN ケーブルで作業スペースまで引く必要がある


- ONU と so-net のパスワードは渡してもらえる

  - NTT からレンタルされるルータは PPPoE パススルーして、こちらで PPPoE する


- 30日に開通テスト成功

  - 管理側のマシンは、有線でも接続できるようにハブを用意したい



その他
------
- 電源タップが全く足りなかった

   - 各自がありったけ持っていく必要ある


- 撤収時、誰の機材か分からなくなる事例が多発

   - 皆同じステッカー貼ってるから、目印としては役に立たない
   - ユニークなステッカーを貼るか名前を書くかしましょう




